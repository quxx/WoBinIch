<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <link rel="stylesheet" href="lib/onsen/css/onsenui.css">
    <link rel="stylesheet" href="lib/onsen/css/onsen-css-components-sunshine-theme.css">
    <link rel="stylesheet" href="css/login.css">
	
    <script src="lib/onsen/js/angular/angular.js"></script>
    <script src="lib/onsen/js/onsenui.js"></script>
	<script src="phonegap.js"></script>
    <script>
	ons.bootstrap();

//Überprüfen ob Gerät mit dem Internet verbunden ist	
	function init() {
		  document.addEventListener("deviceready", onDeviceReady, false);
	}
	
	function onDeviceReady() {
			var networkState = navigator.connection.type;
			/*
			Connection.UNKNOWN  = 'Unknown connection';
			Connection.ETHERNET = 'Ethernet connection';
			Connection.WIFI     = 'WiFi connection';
			Connection.CELL_2G  = 'Cell 2G connection';
			Connection.CELL_3G  = 'Cell 3G connection';
			Connection.CELL_4G  = 'Cell 4G connection';
			Connection.CELL     = 'Cell generic connection';
			Connection.NONE     = 'No network connection'; 
			*/
            if (networkState == Connection.NONE || networkState == Connection.UNKNOWN) {
				ons.createDialog('conn.html').then(function(conn) {
					conn.show();
			});
        }
	}
	
	function checkLogin() {
		if (window.localStorage.getItem("loginname") != "") {
			window.location="home.html"
		}
	}
		
//Login Script, eingabe wird im LocalStorage gespeichert und Login-Link wird generiert	
	function login() {
		var name = document.getElementById('loginname').value;
		var pw = document.getElementById('password').value;
		var link = "http://thm-chat.appspot.com/oop/users?user=" + name + "&password=" + pw;
		
		window.localStorage.setItem("loginname",name);
		window.localStorage.setItem("password",pw);
		window.localStorage.setItem("link",link);
		var user = window.localStorage.getItem("loginname");
		var pass = window.localStorage.getItem("password");
		if (user == "" || pass == "") {
			ons.createDialog('dialog.html').then(function(dialog) {
				dialog.show();
			});
		} else {
			window.location="home.html";
		}
	}
		

	</script>
	
<!-- ********************	Dialog bei keiner Internetverbindung	******************** -->	
	<ons-template id="conn.html">
		<ons-dialog var="conn" animation="default" cancelable>
			<ons-toolbar modifier="transparent" inline fixed-style>
				<!-- Überschrift -->
				<div class="center">
					Warnung
				</div>
			</ons-toolbar>
			<div style="text-align: center">
				<!-- Message -->
				<p>
					Kein Internet
				</p> 
				<!-- Button -->
				<div class="alert-dialog-footer">
					<button class="alert-dialog-button" onclick="conn.hide()">OK</button>
				</div>
			</div>
		</ons-dialog>        
	</ons-template>
	
<!-- ********************	Dialog bei leerem Login Formular	******************** -->	
	<ons-template id="dialog.html">
		<ons-dialog var="dialog" animation="default" cancelable>
			<ons-toolbar modifier="transparent" inline fixed-style>
				<!-- Überschrift -->
				<div class="center">
					Warnung
				</div>
			</ons-toolbar>
			<div style="text-align: center">
				<!-- Message -->
				<p>
					Bitte Benutzername und Password eingeben				
				</p>
				<!-- Button -->				
				<div class="alert-dialog-footer">
					<button class="alert-dialog-button" onclick="dialog.hide()">OK</button>
				</div>
			</div>
		</ons-dialog>        
	</ons-template>		
  </head>
<!-- ********************		BODY		******************** -->
  <body onload="onDeviceReady(); checkLogin()">
    <ons-page>
		<!-- Header Bild -->
		<div class="card">
			<!-- Überschrift -->
			<div class="card-name">Wo bin Ich?</div>
			<!-- Beschreibung -->
			<div class="card-desc">Medienprojektmanagment<br>SS 2015</div>

        </div>
		<div class="login-form">
			<input name="loginname" id="loginname" type="text" class="text-input--underbar" placeholder="Loginname" value="">
			<input name="password" id="password" type="password" class="text-input--underbar" placeholder="Password" value="">
			<br><br>
			<ons-button onclick="login()" modifier="large" class="login-button">Log In</ons-button>
		</div>
		
		<div class="footer">
			Version 1.1
		</div>

    </ons-page>

  </body>
</html>